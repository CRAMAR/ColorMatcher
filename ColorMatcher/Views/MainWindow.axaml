<Window xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:ColorMatcher.ViewModels"
        xmlns:v="using:ColorMatcher.Views"
    x:Class="ColorMatcher.Views.MainWindow"
    x:DataType="vm:MainWindowViewModel"
    Icon="/Assets/avalonia-logo.ico"
    Title="ColorMatcher (Alpha)">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid Margin="24" ColumnDefinitions="340,*" RowDefinitions="Auto,*,Auto">
        <StackPanel Grid.Column="0" Spacing="16">
            <StackPanel>
                <TextBlock Text="ColorMatcher" FontSize="24" FontWeight="SemiBold" />
                <TextBlock Text="Enter target and sample colors to visualize in LAB space." Opacity="0.7" />
            </StackPanel>

            <!-- Project Management -->
            <StackPanel Spacing="8">
                <TextBlock Text="Project" FontWeight="SemiBold" />
                <Border CornerRadius="8" BorderBrush="#2E2E2E" BorderThickness="1" Background="#101010">
                    <StackPanel Spacing="12" Margin="12">
                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="8">
                            <TextBlock Text="Name" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" />
                            <TextBox Text="{Binding ProjectName}" Grid.Row="0" Grid.Column="1" Watermark="Untitled Project" />

                            <TextBlock Text="Description" Grid.Row="1" Grid.Column="0" VerticalAlignment="Top" Margin="0,8,0,0" />
                            <TextBox Text="{Binding ProjectDescription}" Grid.Row="1" Grid.Column="1" Watermark="Optional description" 
                                     AcceptsReturn="True" Height="60" TextWrapping="Wrap" />
                        </Grid>

                        <UniformGrid Columns="2" HorizontalAlignment="Stretch">
                            <Button Content="New Project" Command="{Binding CreateNewProjectCommand}" Margin="0,0,4,0"
                                    ToolTip.Tip="Create a new project with current colors" />
                            <Button Content="Save Project" Command="{Binding SaveProjectCommand}" Margin="4,0,0,0"
                                    ToolTip.Tip="Save project changes to disk" />
                        </UniformGrid>

                        <!-- Project Status Indicator -->
                        <StackPanel Spacing="2" Margin="0,8,0,0">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock FontSize="10" Opacity="0.6" Text="Project:" />
                                <TextBlock FontSize="10" Opacity="0.8" Text="{Binding ProjectName}" FontWeight="Medium" />
                                <TextBlock FontSize="10" Foreground="#FFA726" Text="●" IsVisible="{Binding IsProjectModified}" />
                            </StackPanel>
                            <TextBlock FontSize="9" Foreground="#FFA726" Opacity="0.8"
                                       IsVisible="{Binding IsProjectModified}"
                                       Text="Unsaved changes" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Recent Projects -->
            <StackPanel Spacing="8" IsVisible="{Binding RecentProjects.Count}">
                <TextBlock Text="Recent Projects" FontWeight="SemiBold" FontSize="11" Opacity="0.8" />
                <Border CornerRadius="8" BorderBrush="#2E2E2E" BorderThickness="1" Background="#101010" MaxHeight="180">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding RecentProjects}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button HorizontalAlignment="Stretch" 
                                            HorizontalContentAlignment="Left"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Padding="12,8"
                                            Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).LoadProjectCommand}"
                                            CommandParameter="{Binding}"
                                            ToolTip.Tip="{Binding Description}">
                                        <Button.Styles>
                                            <Style Selector="Button:pointerover">
                                                <Setter Property="Background" Value="#1A1A1A" />
                                            </Style>
                                        </Button.Styles>
                                        <StackPanel Spacing="2">
                                            <TextBlock Text="{Binding Name}" FontSize="11" FontWeight="Medium" />
                                            <TextBlock Text="{Binding ModifiedAt, StringFormat='{}{0:g}'}" 
                                                       FontSize="9" Opacity="0.5" />
                                        </StackPanel>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>
            </StackPanel>

            <StackPanel Spacing="8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Reference Color (Target)" FontWeight="SemiBold" VerticalAlignment="Center" />
                    <TextBlock Text="①" FontSize="10" Opacity="0.5" VerticalAlignment="Center"
                               ToolTip.Tip="Step 1: Enter your target color" />
                </StackPanel>
                <Border CornerRadius="8" BorderBrush="#2E2E2E" BorderThickness="1" Background="#101010">
                    <StackPanel Spacing="12" Margin="12">
                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="8">
                        <TextBlock Text="Hex" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" />
                        <TextBox Text="{Binding ReferenceHex}" Grid.Row="0" Grid.Column="1" Watermark="#FFFFFF" />

                        <TextBlock Text="R" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" />
                        <TextBox Text="{Binding ReferenceR}" Grid.Row="1" Grid.Column="1" Watermark="255" />

                        <TextBlock Text="G" Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" />
                        <TextBox Text="{Binding ReferenceG}" Grid.Row="2" Grid.Column="1" Watermark="255" />

                        <TextBlock Text="B" Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" />
                        <TextBox Text="{Binding ReferenceB}" Grid.Row="3" Grid.Column="1" Watermark="255" />
                    </Grid>

                    <Border Height="72" CornerRadius="8" BorderBrush="#2E2E2E" BorderThickness="1" Background="{Binding ReferenceBrush}">
                        <TextBlock Text="Reference" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.8" />
                    </Border>
                    </StackPanel>
                </Border>
            </StackPanel>

            <StackPanel Spacing="8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Sample Color" FontWeight="SemiBold" VerticalAlignment="Center" />
                    <TextBlock Text="②" FontSize="10" Opacity="0.5" VerticalAlignment="Center"
                               ToolTip.Tip="Step 2: Enter or adjust your sample color" />
                </StackPanel>
                <Border CornerRadius="8" BorderBrush="#2E2E2E" BorderThickness="1" Background="#101010">
                    <StackPanel Spacing="12" Margin="12">
                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="8">
                        <TextBlock Text="Hex" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" />
                        <TextBox Text="{Binding SampleHex}" Grid.Row="0" Grid.Column="1" Watermark="#808080" />

                        <TextBlock Text="R" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" />
                        <TextBox Text="{Binding SampleR}" Grid.Row="1" Grid.Column="1" Watermark="128" />

                        <TextBlock Text="G" Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" />
                        <TextBox Text="{Binding SampleG}" Grid.Row="2" Grid.Column="1" Watermark="128" />

                        <TextBlock Text="B" Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" />
                        <TextBox Text="{Binding SampleB}" Grid.Row="3" Grid.Column="1" Watermark="128" />
                    </Grid>

                    <Border Height="72" CornerRadius="8" BorderBrush="#2E2E2E" BorderThickness="1" Background="{Binding SampleBrush}">
                        <TextBlock Text="Sample" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.8" />
                    </Border>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Accept Color Match -->
            <StackPanel Spacing="4">
                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center" Margin="0,4,0,0">
                    <TextBlock Text="③" FontSize="10" Opacity="0.5" VerticalAlignment="Center" />
                    <TextBlock Text="Review match quality below, then accept" FontSize="9" Opacity="0.5" VerticalAlignment="Center" />
                </StackPanel>
                <Button Content="✓ Accept Match" 
                        Command="{Binding SaveColorMatchCommand}" 
                        HorizontalAlignment="Stretch"
                        Height="40"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Background="#1B5E20"
                        Foreground="White"
                        CornerRadius="8"
                        ToolTip.Tip="Step 3: Save this color match to history">
                    <Button.Styles>
                        <Style Selector="Button:pointerover">
                            <Setter Property="Background" Value="#2E7D32" />
                        </Style>
                    </Button.Styles>
                </Button>
            </StackPanel>
        </StackPanel>

        <Border Grid.Column="1" Grid.Row="0" Grid.RowSpan="2" Margin="24,0,0,0" CornerRadius="12" BorderBrush="#2E2E2E" BorderThickness="1" Background="#141414">
            <StackPanel Margin="24" Spacing="12">
                <TextBlock Text="LAB Color Space" FontSize="20" FontWeight="SemiBold" />
                <v:LabColorGraph x:Name="LabGraph" Height="420" />
                <StackPanel Spacing="4">
                    <TextBlock Text="{Binding ColorDifference, StringFormat='ΔE: {0:F2}'}" FontSize="12"
                               ToolTip.Tip="Color difference: &lt;1 imperceptible, 1-2 barely noticeable, 2-5 perceptible, &gt;5 significant" />
                    <TextBlock Text="{Binding TintRecommendation}" Foreground="#90CAF9" FontSize="11"
                               ToolTip.Tip="Recommended color adjustments to improve match" />
                </StackPanel>
            </StackPanel>
        </Border>

        <Border Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2" Margin="0,12,0,0" CornerRadius="12" BorderBrush="#2E2E2E" BorderThickness="1" Background="#141414" Padding="24">
            <v:ColorHistoryView DataContext="{Binding}" />
        </Border>
    </Grid>

</Window>
